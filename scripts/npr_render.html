<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
    
    
    <script type="x-shader/x-vertex" id="techdrawVertex">
        varying vec3 v_position;
        varying vec3 v_normal;
    
        void main() {
            //v_position = vec3(modelViewMatrix * vec4(position, 1.0));
            v_position = position;
            v_normal = normalize(normalMatrix* normal);
            //v_normal = normal;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>
    <script type="x-shader/x-fragment" id="techdrawFragment">
        //uniforms for phong shading coefficients
        uniform vec3 colorA;
        uniform float k_ambient;
        uniform float k_diffuse;
        uniform float k_specular;
        uniform float p;

        //uniforms for warm to cool
        uniform float blue; //blue in [0, 1]
        uniform float yellow; //yellow in [0, 1]
        uniform float alpha;
        uniform float beta;

        //uniforms for camera and lights
        uniform vec3 cameraPos;
        uniform vec3 lightPos;
        uniform vec3 lightIntensity;
        uniform float lightIntensity_I;

        //outputs from vertex shader
        varying vec3 v_position;
        varying vec3 v_normal;


        vec3 rgb() {
            vec3 n = normalize(v_normal);
            vec3 l = normalize(vec3(lightPos) - v_position);
            vec3 v = normalize(cameraPos - v_position);
            vec3 h = (v + l) / length(v + l);
            
            float r = length(lightPos - v_position); //radius
            vec3 illumination = lightIntensity / (r * r);


            vec3 ambient = k_ambient * vec3(1., 1., 1.);
            vec3 diffuse = k_diffuse * illumination * max(dot(n, l), 0.);
            diffuse = vec3(1., 1., 1.) * max(0., dot(l, n)); //from the paper
            vec3 specular = k_specular * illumination * pow(max(dot(n, h), 0.), p);
            vec3 blinn_phong = ambient + diffuse + specular;
            
            //blinn_phong = ambient;
            //blinn_phong = diffuse;
            //blinn_phong = specular;



            //warm to cool
            vec3 k_blue = vec3(0., 0., blue);
            vec3 k_yellow = vec3(yellow, yellow, 0.);
            vec3 k_cool = k_blue + alpha * vec3(1., 1., 1.); //kd = 1
            vec3 k_warm = k_yellow + beta * vec3(1., 1., 1.); //kd = 1
            //vec3 k_cool = vec3(0.,0.,0.);
            //vec3 k_warm = vec3(1.,1.,1.);




           // float diff = max(dot(n, l), 0.0);
            //vec3 ref = diff*vec3(0.5, 0.5, 0.5);
            //return ambient + diff;
           // return specular + ((1. + dot(l, n)) / 2.) * k_cool;
//           return (1. - ((1. + dot(l, n)) / 2.))*vec3(1.,1.,1.);

           //return ((1. + dot(l, n)) / 2.)*vec3(1.,1.,1.);
           return specular + ((1. + dot(l, n)) / 2.) * k_cool + (1. - ((1. + dot(l, n)) / 2.)) * k_warm;
        }

        void main() {
            gl_FragColor = vec4(rgb(), 1.0);
        }
    </script>
	<body>
        <div class="slidecontainer">
            <p>Blue Value: <span id="BlueVal"></span></p>
            <input type="range" min="1" max="100" value="20" class="slider" id="BlueRange">
            
        </div>
        <div class="slidecontainer">
            <p>Yellow Value: <span id="YellowVal"></span></p>
            <input type="range" min="1" max="100" value="80" class="slider" id="YellowRange">
            
        </div>
        <div class="slidecontainer">
            <p>Alpha Value: <span id="AlphaVal"></span></p>
            <input type="range" min="1" max="100" value="20" class="slider" id="AlphaRange">
            
        </div>
        <div class="slidecontainer">
            <p>Beta Value: <span id="BetaVal"></span></p>
            <input type="range" min="1" max="100" value="60" class="slider" id="BetaRange">
            
        </div>
		<script src="./js/three.js"></script>
		<script>
            var bslider = document.getElementById("BlueRange");
            var boutput = document.getElementById("BlueVal");
            boutput.innerHTML = bslider.value/100;
            
            var yslider = document.getElementById("YellowRange");
            var youtput = document.getElementById("YellowVal");
            youtput.innerHTML = yslider.value/100;
            var aslider = document.getElementById("AlphaRange");
            var aoutput = document.getElementById("AlphaVal");
            aoutput.innerHTML = aslider.value/100;
            var beslider = document.getElementById("BetaRange");
            var beoutput = document.getElementById("BetaVal");
            beoutput.innerHTML = beslider.value/100;
			const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf8f8ff);

			const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
            camera.position.z = 5;

			const renderer = new THREE.WebGLRenderer({antialias: true});
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );


            //lights
            var pointLight = new THREE.PointLight(0xffffff, 7.0);
            //pointLight.position.set(0.0, 2000.0, 0.0);
            pointLight.position.set(1.5, 1.5, 1.5);
            scene.add(pointLight);
            pointLight.intensity = 0.5;


			const geometry = new THREE.TorusKnotGeometry( );

            const material = new THREE.ShaderMaterial({
                uniforms: {
                    //phong shading coeffs
                    colorA: {type: 'vec4', value: new THREE.Color( 0xed64b4 )},
                    k_ambient: {type: 'f', value: 0.4},
                    k_diffuse: {type: 'f', value: 3.}, //watercolor uses 3.
                    k_specular: {type: 'f', value: 30.}, //default for three js is 30
                    p: {type: 'f', value: 50.},

                    //warm to cool coeffs
                    blue: {type: 'float', value: boutput.innerHTML}, //blue in [0, 1]
                    yellow: {type: 'float', value: youtput.innerHTML}, //yellow in [0, 1]
                    alpha: {type: 'float', value:aoutput.innerHTML},
                    beta: {type: 'float', value: beoutput.innerHTML},

                    //scene vars
                    cameraPos: {type: 'vec3', value: camera.position},
                    lightPos: {type: 'vec3', value: pointLight.position},
                    lightIntensity: {type: 'vec3', value: new THREE.Vector3().addScalar(pointLight.intensity)},
                    lightIntensity_I: {type: 'float', value: pointLight.intensity}
                },
                vertexShader: document.getElementById('techdrawVertex').textContent,
                fragmentShader: document.getElementById('techdrawFragment').textContent
            });
            material.needsUpdate = true;

            
			const torusKnot = new THREE.Mesh( geometry, material );
        
            

            bslider.oninput = function() {
                boutput.innerHTML = this.value/100;
                torusKnot.material.uniforms.blue.value = boutput.innerHTML;
            }
            

            yslider.oninput = function() {
                youtput.innerHTML = this.value/100;
                torusKnot.material.uniforms.yellow.value = youtput.innerHTML; 
            }

            aslider.oninput = function() {
                aoutput.innerHTML = this.value/100;
                torusKnot.material.uniforms.alpha.value = aoutput.innerHTML; 
            }
            beslider.oninput = function() {
                beoutput.innerHTML = this.value/100;
                torusKnot.material.uniforms.beta.value = beoutput.innerHTML; 
            }
           
			scene.add( torusKnot );

			var outline = new THREE.MeshBasicMaterial({color:0x000000, side:THREE.BackSide});
            var outmesh = new THREE.Mesh(geometry, outline);
            outmesh.position = torusKnot.position;
            outmesh.scale.multiplyScalar(1.05);
            scene.add(outmesh);
            var inline = new THREE.MeshBasicMaterial({color:0x000000, side:THREE.BackSide});
            var inmesh = new THREE.Mesh(geometry, inline);
            inmesh.position = torusKnot.position;
            inmesh.scale.multiplyScalar(0.93    );
            scene.add(inmesh);


			

			function animate() {
				requestAnimationFrame( animate );
				renderer.render( scene, camera );
                //torusKnot.material.blue.value = 0.5; // there is also setHSV and setRGB
                //torusKnot.material.yellow.value = 0.5; 
                //torusKnot.update();
                
				torusKnot.rotation.x += 0.0;
				torusKnot.rotation.y += 0.0;

				outmesh.rotation.x += 0.0;
				outmesh.rotation.y += 0.0;
                inmesh.rotation.x += 0.0;
				inmesh.rotation.y += 0.0;

			}
			animate();

		</script>
	</body>
</html>